<mat-card>
    <h1>Data Handler Configuration</h1>
    <div class="database-uplink">
        <div class="forms">
            <mat-form-field>
            <mat-label>Name</mat-label>
            <input matInput [(ngModel)]="newDatabase.name" placeholder="schedulerDB" />
            </mat-form-field>
        </div>
        <div class="forms">
            <mat-form-field>
                <mat-label>IP</mat-label>
                <input matInput [(ngModel)]="newDatabase.address" placeholder="127.0.0.1" />
            </mat-form-field>
        </div>
        <div class="forms">
            <mat-form-field>
                <mat-label>Port</mat-label>
                <input matInput [(ngModel)]="newDatabase.port" placeholder="8888" />
            </mat-form-field>
        </div>
        <div class="forms">
            <form>
                <mat-form-field appearance="fill">
                    <mat-label>Select a database</mat-label>
                    <mat-select [(ngModel)]="selectedDatabase" name="test2">
                        <mat-option
                            *ngFor="let database of databases"
                            [value]="database.name"
                        >
                            {{ database.name }}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
            </form>
        </div>
    </div>
    <div class="database-uplink">
        <div class="buttons">
            <button mat-flat-button color="primary" aria-label="Add database" matTooltip="Add the specified database configuration"(click)="addDatabase()">
                Add
            </button>
        </div>
        <div class="buttons">
            <button mat-flat-button color="primary" aria-label="Add database" matTooltip="Refresh the saved database configurations"(click)="getDatabases()">Refresh</button>
        </div>
        <div class="buttons">
            <button mat-flat-button color="primary" aria-label="Add database" matTooltip="Delete the selected database configuration"(click)="deleteDatabase(selectedDatabase)">Delete</button>
        </div>
    </div>
</mat-card>

<mat-card>
    <mat-card-header>
        <mat-card-title matTooltip="These devices are locked by active experiments">Active devices</mat-card-title>
    </mat-card-header>
    <table
        mat-table
        [dataSource]="dataSourceActive"
        multiTemplateDataRows
        class="mat-elevation-z8"
    >
        <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef>Device name</th>
            <td mat-cell *matCellDef="let element">
                {{ element.device.name }}
            </td>
        </ng-container>

        <ng-container matColumnDef="database">
            <th mat-header-cell *matHeaderCellDef>Database</th>
            <td mat-cell *matCellDef="let element">
                <!-- {{ element.database.ip }} -->
                Database Name
            </td>
        </ng-container>

        <ng-container matColumnDef="address">
            <th mat-header-cell *matHeaderCellDef>Address</th>
            <td mat-cell *matCellDef="let element">
                Database-IP
                <!--  {{ element.database.address }} -->
            </td>
        </ng-container>

        <ng-container matColumnDef="port">
            <th mat-header-cell *matHeaderCellDef>Port</th>
            <td mat-cell *matCellDef="let element">
                Database-Port
                <!--  {{ element.database.port }} -->
            </td>
        </ng-container>

        <ng-container matColumnDef="online">
            <th mat-header-cell *matHeaderCellDef>Online</th>
            <td mat-cell *matCellDef="let element">
                <!-- The Online status of the database is needed here! -->
                <span
                    [ngStyle]="
                        element.status.online
                            ? { color: 'green' }
                            : { color: 'red' }
                    "
                >
                </span>
                <span
                    class="circle"
                    [ngStyle]="
                        element.status.online
                            ? { 'background-color': 'green' }
                            : { 'background-color': 'red' }
                    "
                >
                </span>
            </td>
        </ng-container>

        <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef>Status</th>
            <td mat-cell *matCellDef="let element">
                <!-- The Status of the database is needed here! -->
                {{
                    element.status.length == 0
                        ? 'Unknown'
                        : element.status.status
                }}
            </td>
        </ng-container>

        <ng-container matColumnDef="edit">
            <th mat-header-cell *matHeaderCellDef></th>
            <td mat-cell *matCellDef="let element; let i = dataIndex">
                <button mat-icon-button (click)="showDetails(i, true)">
                    <mat-icon matTooltip="Expand to view device detail">info</mat-icon>
                </button>
                <button mat-icon-button (click)="link(i, true)" >
                    <mat-icon matTooltip="Link a database for this device">link</mat-icon>
                </button>
            </td>
        </ng-container>

        <ng-container matColumnDef="data_transfer">
            <th mat-header-cell *matHeaderCellDef style="text-align: right">Data transfer</th>
            <td mat-cell *matCellDef="let element" style="text-align: right; padding-right: 46px">
                <mat-checkbox
                    [(ngModel)]="dataTransferCheckbox"
                ></mat-checkbox>
            </td>
        </ng-container>
        <!-- Expanded Row-->
        <ng-container matColumnDef="expandedDetail">
            <td
                mat-cell
                *matCellDef="let element; let i = dataIndex"
                [attr.colspan]="tableColumns.length"
            >
                <div
                    class="expanded-element"
                    [@detailExpand]="selected === i && active === true? 'expanded' : 'collapsed'"
                >
                    <div class="details">
                        <h2>Details</h2>
                        <p>UUID: {{ element.device.uuid }}</p>
                    </div>
                    <div class="features">

                        <div class="feature-elements"><h2>Features</h2></div>
                        <div class="feature-elements"></div>
                        <div class="feature-elements">Meta</div>
                        <div class="feature-elements">Active</div>
                    </div>
                    <div class="features">
                        <app-data-handler-device-detail
                            *ngIf="element.detailsLoaded"
                            [device]="element.device"
                        ></app-data-handler-device-detail>
                    </div>
                </div>
            </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="tableColumns"></tr>
        <tr
            mat-row
            class="row"
            [class.expanded]="i === selected && active === true"
            *matRowDef="let row; columns: tableColumns; let i = dataIndex"
        ></tr>
        <tr
            mat-row
            class="expanded-row"
            *matRowDef="let row2; columns: ['expandedDetail']"
        ></tr>
    </table>

    <mat-card-actions>
        <button mat-icon-button color="primary" (click)="refresh()">
            <mat-icon matTooltip="Refresh the active device list">refresh</mat-icon>
        </button>
    </mat-card-actions>
</mat-card>

<mat-card>
    <mat-card-header>
        <mat-card-title matTooltip="Devices that are not currently locked by an experiment">Inactive devices</mat-card-title>
    </mat-card-header>
    <table
        mat-table
        [dataSource]="dataSourceInactive"
        multiTemplateDataRows
        class="mat-elevation-z8"
    >
        <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef>Device name</th>
            <td mat-cell *matCellDef="let element">
                {{ element.device.name }}
            </td>
        </ng-container>

        <ng-container matColumnDef="database">
            <th mat-header-cell *matHeaderCellDef>Database</th>
            <td mat-cell *matCellDef="let element">
                <!-- {{ element.database.ip }} -->
                Database Name
            </td>
        </ng-container>

        <ng-container matColumnDef="address">
            <th mat-header-cell *matHeaderCellDef>Address</th>
            <td mat-cell *matCellDef="let element">
                Database-IP
                <!--  {{ element.database.address }} -->
            </td>
        </ng-container>

        <ng-container matColumnDef="port">
            <th mat-header-cell *matHeaderCellDef>Port</th>
            <td mat-cell *matCellDef="let element">
                Database-Port
                <!--  {{ element.database.port }} -->
            </td>
        </ng-container>

        <ng-container matColumnDef="online">
            <th mat-header-cell *matHeaderCellDef>Online</th>
            <td mat-cell *matCellDef="let element">
                <!-- The Online status of the database is needed here! -->
                <span
                    [ngStyle]="
                        element.status.online
                            ? { color: 'green' }
                            : { color: 'red' }
                    "
                >
                </span>
                <span
                    class="circle"
                    [ngStyle]="
                        element.status.online
                            ? { 'background-color': 'green' }
                            : { 'background-color': 'red' }
                    "
                >
                </span>
            </td>
        </ng-container>

        <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef>Status</th>
            <td mat-cell *matCellDef="let element">
                <!-- The Status of the database is needed here! -->
                {{
                    element.status.length == 0
                        ? 'Unknown'
                        : element.status.status
                }}
            </td>
        </ng-container>

        <ng-container matColumnDef="edit">
            <th mat-header-cell *matHeaderCellDef></th>
            <td mat-cell *matCellDef="let element; let i = dataIndex">
                <button mat-icon-button (click)="showDetails(i, false)">
                    <mat-icon matTooltip="Expand to view device detail">info</mat-icon>
                </button>
                <button mat-icon-button (click)="link(i, false)" >
                    <mat-icon matTooltip="Link a database for this device">link</mat-icon>
                </button>
                <!--<button mat-icon-button (click)="delete(i)">
                    <mat-icon>delete</mat-icon>
                </button>-->
            </td>
        </ng-container>

        <ng-container matColumnDef="data_transfer">
            <th mat-header-cell *matHeaderCellDef style="text-align: right">Data transfer</th>
            <td mat-cell *matCellDef="let element" style="text-align: right; padding-right: 46px">
                <mat-checkbox
                    [(ngModel)]="dataTransferCheckbox"
                ></mat-checkbox>
            </td>
        </ng-container>
        <!-- Expanded Row-->
        <ng-container matColumnDef="expandedDetail">
            <td
                mat-cell
                *matCellDef="let element; let i = dataIndex"
                [attr.colspan]="tableColumns.length"
            >
                <div
                    class="expanded-element"
                    [@detailExpand]="selected === i && active === false? 'expanded' : 'collapsed'"
                >
                    <div class="details">
                        <h2>Details</h2>
                        <p>UUID: {{ element.device.uuid }}</p>
                    </div>
                    <div class="features">

                        <div class="feature-elements"><h2>Features</h2></div>
                        <div class="feature-elements"></div>
                        <div class="feature-elements">Meta</div>
                        <div class="feature-elements">Active</div>
                    </div>
                    <div class="features">
                        <app-data-handler-device-detail
                            *ngIf="element.detailsLoaded"
                            [device]="element.device"
                        ></app-data-handler-device-detail>
                    </div>
                </div>
            </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="tableColumns"></tr>
        <tr
            mat-row
            class="row"
            [class.expanded]="i === selected && active === false"
            *matRowDef="let row; columns: tableColumns; let i = dataIndex"
        ></tr>
        <tr
            mat-row
            class="expanded-row"
            *matRowDef="let row2; columns: ['expandedDetail']"
        ></tr>
    </table>

    <mat-card-actions>
        <button mat-icon-button color="primary" (click)="refresh()">
            <mat-icon matTooltip="Refresh the inactive device list">refresh</mat-icon>
        </button>
    </mat-card-actions>
</mat-card>
